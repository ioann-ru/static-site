(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1219:function(t,i,s){"use strict";s.r(i),function(t){s(1263);var e=s(0),n=s.n(e),o=s(2),a=s(1),c=s(24),u=s(4),r=s(5),l=s(7);function h(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var d=12e4,p=function(){function i(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.visitToNewPartTime=Number(sessionStorage.getItem("guestFirstVisit")),this.shownNotificationsString=sessionStorage.getItem("shownNotificationsList"),this.shownBigsaleString=sessionStorage.getItem("shownNoticeBigsaleList"),this.shownBigsaleList=null!==this.shownBigsaleString?this.shownBigsaleString.split(","):[],this.shownNotificationsList=null!==this.shownNotificationsString?this.shownNotificationsString.split(","):[],this.shownQuestionString=sessionStorage.getItem("shownQuestionsList"),this.shownQuestionsList=null!==this.shownQuestionString?this.shownQuestionString.split(","):[],this.subscribedNotificationsString=c.a.get("subscribedNotificationsList"),this.subscribedNotificationsList=this.subscribedNotificationsString?this.subscribedNotificationsString.split(","):[],this.lastSubscriptionType=Number(sessionStorage.getItem("lastSubscriptionType")),this.currentSubscriptionType=this.choiceSubscriptionType(),this.questionShow=a.d,this.noticeBigsaleShow=a.d,this.$counter=t(".js-notice-counter"),this.$popUp=t(".js-notice-popup"),this.$container=t(".js-guest-notification"),this.$iconNotice=t(".js-notice-bell"),this.init()}var s,e,p;return s=i,(e=[{key:"init",value:function(){var t=this;if(Object(u.e)())this.removeGuestSubscribesData();else{this.currentSubscriptionType&&this.currentSubscriptionType!==this.lastSubscriptionType&&(this.visitToNewPartTime=Date.now(),sessionStorage.setItem("guestFirstVisit",this.visitToNewPartTime)),this.shownNotificationsList.length!==a.d&&this.addOldNotices(),new Date<new Date("2019-11-19")&&this.setTimeoutForBigsaleNotice(),this.addNoticeSubscribe();var i=Date.now()-this.visitToNewPartTime;i>d?this.showUnreadNotifications():setTimeout((function(){t.showUnreadNotifications()}),d-i),this.initBaseEvents()}}},{key:"subscribeGuestToContent",value:function(i,s){var e=this,a='[data-type ="'.concat(s,'"]');t.ajax({url:Object(o.o)("subscribes/subscribeGuestToNews"),type:"post",data:{subscriptionType:s,guestEmail:i,typePageForEmailSending:s},dataType:"json"}).done((function(i){i.result&&0===i.retCode?(e.addIdToSubscribedList(s),l.a.show(n.a._("Отлично! Подписка оформлена")),t(a).remove(),e.closePopup()):3===i.retCode?l.a.show(n.a._("Введите верный email")):4===i.retCode?(e.addIdToSubscribedList(s),t(a).remove(),l.a.show(n.a._("Вы уже подписаны"))):l.a.show(n.a._("Ошибка при регистрации подписки"))})).fail((function(){l.a.show(n.a._("Ошибка передачи данных"))}))}},{key:"addNoticeSubscribe",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.d,s=i||3,e=!i&&this.currentSubscriptionType?"js-notice-unread":"";if(!(!i&&this.checkShownNotice(s)||this.checkSubscribedNotice(s))){var o={3:n.a._("Выберите свой талисман!")},c={3:n.a._("На основе уникального гороскопа камней")},u='\n\t\t\t<div class="notice-subscribe js-notice-subscribe '.concat(e,'" data-type="').concat(s,'">\n\t\t\t\t<div class="notice-subscribe__text">\n\t\t\t\t\t<span class="notice-subscribe__heading">').concat(o[s],'</span>\n\t\t\t\t\t<span class="notice-subscribe__discription">').concat(c[s],'</span>\n\t\t\t\t</div>\n\t\t\t\t<form action="#" class="notice-subscribe__form js-notice-bubscribe-form">\n\t\t\t\t\t<input required type="email"\n\t\t\t\t\t\t\t\t\tclass="notice-subscribe__email js-email-subscribe"\n\t\t\t\t\t\t\t\t\tdata-type="').concat(s,'"\n\t\t\t\t\t\t\t\t\tplaceholder="').concat(n.a._("Введите свой email"),'">\n\t\t\t\t\t<input type="submit" class="notice-subscribe__button js-btn-subscribe" value="').concat(n.a._("Получить"),'">\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t'),r=t(".js-guest-notification");r.prepend(u)}}},{key:"setTimeoutForQuestion",value:function(){var t=this;setTimeout((function(){t.addNoticeQuestion(),t.$popUp.hasClass("notice-popup--active")&&t.$counter.html()?(t.setCounterValue(3),t.removeUnreadFlag()):t.showUnreadNotifications()}),d)}},{key:"addNoticeQuestion",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.d,s=i?"":"js-notice-unread",e={1:n.a._("Выгодные условия"),2:n.a._("Хотите продавать на Ярмарке Мастеров?"),3:n.a._("Нет времени ждать?"),4:n.a._("Покупай безопасно")},o={1:"".concat(n.a._("Покупай товары со специальной"),' <a href="/sale/online/?privilege=1&action=paging&utm_source=okno&utm_medium=glavnaya&utm_campaign=pp">').concat(n.a._("скидкой от 20%"),"</a>"),2:"".concat(n.a._("Откройте магазин "),'\n\t\t\t\t<a href="#" class="js-question-create-shop js-quick-create-shop-btn" data-action="QuickCreateShop" type="button">\n\t\t\t\t\t').concat(n.a._("прямо сейчас"),"\n\t\t\t\t</a>"),3:"".concat(n.a._("Покупай готовые товары. "),'\n\t\t\t\t<a href="/sale/online/?bankcard=1&utm_source=livemaster&utm_medium=actual&utm_campaign=safedeal">\n\t\t\t\t\t').concat(n.a._("Купить"),"\n\t\t\t\t</a>"),4:'<a href="/sale/online/?privilege=1&action=paging&utm_source=okno&utm_medium=glavnaya&utm_campaign=oo">'.concat(n.a._("Оплачивай онлайн с гарантией"),"</a>")};for(var c in e)if(!this.checkShownQuestion(c)){this.questionShow=c;break}var u=i||this.questionShow;if(u){var r="",l="";switch(u){case"1":r="notice-question__img--special-discount",l="notice-question--h-90";break;case"3":r="notice-question__img--safe-deal";break;case"4":r="notice-question__img--online-pay"}var h='\n\t\t\t<div class="notice-question js-notice-question '.concat(s," ").concat(l,'" data-id="').concat(u,'">\n\t\t\t\t<div class="notice-question__img ').concat(r,'"></div>\n\t\t\t\t<span class="notice-question__heading">').concat(e[u],'</span>\n\t\t\t\t<span class="notice-question__content">').concat(o[u],"</span>\n\t\t\t</div>"),d=t(".js-guest-notification");d.append(h)}}},{key:"setTimeoutForBigsaleNotice",value:function(){var t=this;setTimeout((function(){t.addNoticeBigsale(),t.$popUp.hasClass("notice-popup--active")&&t.$counter.html()?(t.setCounterValue(2),t.removeUnreadFlag()):t.showUnreadNotifications()}),1e4)}},{key:"addNoticeBigsale",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.d,s=i?"":"js-notice-unread",e={1:n.a._("Скоро распродажа Чёрная пятница!")},o={1:n.a._('Хотите узнать о старте первым и ухватить лучшие скидки? <a href="https://www.livemaster.ru/bigsale/30-friday2019">Получить приглашение</a>')};for(var c in e)if(!this.checkShownBigsaleNotice(c)){this.noticeBigsaleShow=c;break}var u=i||this.noticeBigsaleShow;if(u){var r='\n\t\t\t<div class="notice-bigsale js-notice-bigsale '.concat(s,'" data-id="').concat(u,'">\n\t\t\t\t<div class="notice-bigsale__img"></div>\n\t\t\t\t<span class="notice-bigsale__heading">').concat(e[u],'</span>\n\t\t\t\t<span class="notice-bigsale__content">').concat(o[u],"</span>\n\t\t\t</div>"),l=t(".js-guest-notification");l.append(r)}}},{key:"setCounterValue",value:function(t){var i=t||"";this.$counter.html(i)}},{key:"choiceSubscriptionType",value:function(){var t=window.location.pathname.split("?")[a.d].split("/"),i=t[a.b],s=Object(r.b)("#locale-client-data"),e=s.isShop,n=s.isOnlineAcademy,o=s.isItem,c=s.isZhurnal;return["catalogue","item","gallery","lastlist",""].indexOf(i)!==a.a||o||e||"sale"===i&&"online"===t[2]?3:["community","topic","topics","masterclasses"].indexOf(i)!==a.a||"sale"===i&&!t[2]||c?2:!("onlineacademy"!==i&&!n)&&SUBSCRIPTION_TYPE_ABOUT_WEBINARS}},{key:"removeGuestSubscribesData",value:function(){sessionStorage.setItem("guestFirstVisit",null),sessionStorage.setItem("shownNotificationsList",null),sessionStorage.setItem("shownQuestionsList",null),sessionStorage.setItem("shownNoticeBigsaleList",null),sessionStorage.setItem("lastSubscriptionType",null),c.a.unset("subscribedNotificationsList")}},{key:"closePopup",value:function(){this.$popUp.toggleClass("notice-popup--active",!1),t(".js-notice-subscribe").show(),t(".js-notice-question").show(),t(".js-notice-bigsale").show(),this.setCounterValue(a.d)}},{key:"checkShownNotice",value:function(t){return this.shownNotificationsList.indexOf(String(t))!==a.a}},{key:"checkShownQuestion",value:function(t){return this.shownQuestionsList.indexOf(String(t))!==a.a}},{key:"checkShownBigsaleNotice",value:function(t){return this.shownBigsaleList.indexOf(String(t))!==a.a}},{key:"checkSubscribedNotice",value:function(t){return this.subscribedNotificationsList.indexOf(String(t))!==a.a}},{key:"openPopup",value:function(){this.$popUp.toggleClass("notice-popup--active",!0),this.removeUnreadFlag()}},{key:"removeUnreadFlag",value:function(){var i=this;t(".js-notice-unread").each((function(s,e){var n=t(e);n.hasClass("js-notice-subscribe")?i.addSubscribeIdToShownList(n.data("type")):n.hasClass("js-notice-question")?i.addQuestionIdToShownList(n.data("id")):n.hasClass("js-notice-bigsale")&&i.addBigsaleIdToShownList(n.data("id")),t(e).removeClass("js-notice-unread")}))}},{key:"showUnreadNotifications",value:function(){var i=t(".js-notice-unread"),s=t(".js-guest-notification > :not(.js-notice-unread)"),e=i.length;e!==a.d&&(s.hide(),this.openPopup(),this.setCounterValue(e))}},{key:"addOldNotices",value:function(){var t=this;this.shownNotificationsList.forEach((function(i){"null"!=i&&t.addNoticeSubscribe(i)})),this.shownBigsaleList.forEach((function(i){"null"!=i&&t.addNoticeBigsale(i)})),this.shownQuestionsList.forEach((function(i){"null"!=i&&t.addNoticeQuestion(i)}))}},{key:"addIdToSubscribedList",value:function(t){this.checkSubscribedNotice(t)||(this.subscribedNotificationsList.push(t),c.a.set("subscribedNotificationsList",this.subscribedNotificationsList.join(",")))}},{key:"addSubscribeIdToShownList",value:function(t){this.checkShownNotice(t)||(this.shownNotificationsList.push(t),sessionStorage.setItem("shownNotificationsList",this.shownNotificationsList.join(",")))}},{key:"addQuestionIdToShownList",value:function(t){this.checkShownQuestion(t)||(this.shownQuestionsList.push(t),sessionStorage.setItem("shownQuestionsList",this.shownQuestionsList.join(",")))}},{key:"addBigsaleIdToShownList",value:function(t){this.checkShownBigsaleNotice(t)||(this.shownBigsaleList.push(t),sessionStorage.setItem("shownNoticeBigsaleList",this.shownBigsaleList.join(",")))}},{key:"initBaseEvents",value:function(){var i=this;t(".js-guest-notification").on("submit",".js-notice-bubscribe-form",(function(s){var e=t(s.currentTarget).find(".js-email-subscribe"),n=e.val(),o=e.data("type");i.subscribeGuestToContent(n,o),s.preventDefault()})),t(".js-guest-notification").on("click",".js-notice-subscribe",(function(i){var s=t(i.target),e=s;s.hasClass("js-notice-subscribe")||(e=s.closest(".js-notice-subscribe"));var n=e.data("type");s.closest(".js-notice-bubscribe-form").length===a.d&&(location.href=Object(o.o)({2:"zhurnal",3:"/"}[n]))})),this.$iconNotice.click((function(){var s=Object(r.b)("#locale-client-data"),e=s.isTalentsPage,n=s.userId;e&&n>a.d&&(location.href=Object(o.o)("notificationfeed")),t(".js-guest-notification").children().length!==a.d&&(i.$popUp.hasClass("notice-popup--active")?i.closePopup():i.openPopup())})),t(".js-notification-close").click((function(){i.closePopup()})),t(document).mouseup((function(s){t(s.target).closest(".header__nav-item--bell").length===a.d&&i.closePopup()})),t(".js-header-menu").on("mouseover",(function(){i.closePopup()}))}}])&&h(s.prototype,e),p&&h(s,p),i}();i.default=p}.call(this,s(8))},1263:function(t,i,s){}}]);